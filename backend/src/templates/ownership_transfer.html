<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”„ Ownership Transfer - System Builder Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .main-content {
            padding: 2rem 0;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
            padding: 1.5rem;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .transfer-card {
            border-left: 4px solid #667eea;
            margin-bottom: 1rem;
        }
        
        .status-badge {
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
        }
        
        .status-pending {
            background: #ffc107;
            color: black;
        }
        
        .status-in-progress {
            background: #007bff;
            color: white;
        }
        
        .status-completed {
            background: #28a745;
            color: white;
        }
        
        .status-failed {
            background: #dc3545;
            color: white;
        }
        
        .status-revoked {
            background: #6c757d;
            color: white;
        }
        
        .security-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
        }
        
        .security-standard {
            background: #e9ecef;
            color: #495057;
        }
        
        .security-encrypted {
            background: #d4edda;
            color: #155724;
        }
        
        .security-signed {
            background: #fff3cd;
            color: #856404;
        }
        
        .security-encrypted-signed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .back-to-dashboard {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-to-dashboard:hover {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .tab-content {
            padding: 1.5rem 0;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px 8px 0 0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-exchange-alt me-2"></i>System Builder Hub
            </a>
            <a href="/" class="back-to-dashboard">
                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>
    </nav>

    <div class="main-content">
        <div class="container">
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="text-white text-center mb-3">
                        <i class="fas fa-exchange-alt me-3"></i>Ownership Transfer
                    </h1>
                    <p class="text-white text-center opacity-75">
                        Secure, seamless, and auditable system handoffs to external parties
                    </p>
                </div>
            </div>

            <!-- Metrics Overview -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="total-transfers">0</div>
                        <div class="metric-label">Total Transfers</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="active-transfers">0</div>
                        <div class="metric-label">Active Transfers</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="completed-transfers">0</div>
                        <div class="metric-label">Completed</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="total-exports">0</div>
                        <div class="metric-label">Total Exports</div>
                    </div>
                </div>
            </div>

            <!-- Main Content Tabs -->
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="transferTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="transfers-tab" data-bs-toggle="tab" data-bs-target="#transfers" type="button" role="tab">
                                <i class="fas fa-exchange-alt me-2"></i>Transfer Requests
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="exports-tab" data-bs-toggle="tab" data-bs-target="#exports" type="button" role="tab">
                                <i class="fas fa-download me-2"></i>System Exports
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                                <i class="fas fa-history me-2"></i>Transfer History
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="configs-tab" data-bs-toggle="tab" data-bs-target="#configs" type="button" role="tab">
                                <i class="fas fa-cog me-2"></i>Export Configs
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                                <i class="fas fa-shield-alt me-2"></i>Security & Audit
                            </button>
                        </li>
                    </ul>
                </div>
                
                <div class="card-body">
                    <div class="tab-content" id="transferTabContent">
                        <!-- Transfer Requests Tab -->
                        <div class="tab-pane fade show active" id="transfers" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createTransferModal">
                                        <i class="fas fa-plus me-2"></i>Create Transfer Request
                                    </button>
                                </div>
                            </div>
                            <div id="transfer-requests">
                                <!-- Transfer requests will be loaded here -->
                            </div>
                        </div>

                        <!-- System Exports Tab -->
                        <div class="tab-pane fade" id="exports" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exportSystemModal">
                                        <i class="fas fa-download me-2"></i>Export System
                                    </button>
                                </div>
                            </div>
                            <div id="system-exports">
                                <!-- System exports will be loaded here -->
                            </div>
                        </div>

                        <!-- Transfer History Tab -->
                        <div class="tab-pane fade" id="history" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="history-search" placeholder="Search transfers...">
                                </div>
                                <div class="col-md-6">
                                    <select class="form-select" id="history-filter">
                                        <option value="">All Actions</option>
                                        <option value="transfer_request_created">Transfer Created</option>
                                        <option value="transfer_completed">Transfer Completed</option>
                                        <option value="transfer_failed">Transfer Failed</option>
                                        <option value="transfer_revoked">Transfer Revoked</option>
                                    </select>
                                </div>
                            </div>
                            <div id="transfer-history">
                                <!-- Transfer history will be loaded here -->
                            </div>
                        </div>

                        <!-- Export Configs Tab -->
                        <div class="tab-pane fade" id="configs" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createConfigModal">
                                        <i class="fas fa-plus me-2"></i>Create Export Config
                                    </button>
                                </div>
                            </div>
                            <div id="export-configs">
                                <!-- Export configurations will be loaded here -->
                            </div>
                        </div>

                        <!-- Security & Audit Tab -->
                        <div class="tab-pane fade" id="security" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h4>Security Overview</h4>
                                    <div class="card">
                                        <div class="card-body">
                                            <h6>Encryption Status</h6>
                                            <div class="progress mb-3">
                                                <div class="progress-bar" style="width: 85%"></div>
                                            </div>
                                            <p>85% of transfers are encrypted</p>
                                            
                                            <h6>Digital Signatures</h6>
                                            <div class="progress mb-3">
                                                <div class="progress-bar" style="width: 92%"></div>
                                            </div>
                                            <p>92% of bundles are digitally signed</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h4>Audit Log</h4>
                                    <div id="audit-log">
                                        <!-- Audit log will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Transfer Modal -->
    <div class="modal fade" id="createTransferModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Transfer Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="transferForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">System ID</label>
                                    <input type="text" class="form-control" id="transferSystemId" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Transfer Type</label>
                                    <select class="form-select" id="transferType" required>
                                        <option value="full_transfer">Full Transfer</option>
                                        <option value="partial_transfer">Partial Transfer</option>
                                        <option value="export_only">Export Only</option>
                                        <option value="license_transfer">License Transfer</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Transfer Scope</label>
                                    <select class="form-select" id="transferScope" required>
                                        <option value="full_system">Full System</option>
                                        <option value="agents_only">Agents Only</option>
                                        <option value="models_only">Models Only</option>
                                        <option value="ui_only">UI Only</option>
                                        <option value="api_only">API Only</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Export Format</label>
                                    <select class="form-select" id="exportFormat" required>
                                        <option value="zip">ZIP</option>
                                        <option value="tar">TAR</option>
                                        <option value="tar_gz">TAR.GZ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Security Level</label>
                                    <select class="form-select" id="securityLevel" required>
                                        <option value="standard">Standard</option>
                                        <option value="encrypted">Encrypted</option>
                                        <option value="signed">Digitally Signed</option>
                                        <option value="encrypted_signed">Encrypted & Signed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Recipient Organization (Optional)</label>
                                    <input type="text" class="form-control" id="toOrgId">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <h6>Include Components</h6>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeModels" checked>
                                            <label class="form-check-label" for="includeModels">
                                                Models
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeTrainingData">
                                            <label class="form-check-label" for="includeTrainingData">
                                                Training Data
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeAnalytics" checked>
                                            <label class="form-check-label" for="includeAnalytics">
                                                Analytics
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="includeLicenses" checked>
                                            <label class="form-check-label" for="includeLicenses">
                                                Licenses
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Transfer Notes</label>
                            <textarea class="form-control" id="transferNotes" rows="3" placeholder="Additional notes about this transfer..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createTransferRequest()">Create Transfer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export System Modal -->
    <div class="modal fade" id="exportSystemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Export System</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="exportForm">
                        <div class="mb-3">
                            <label class="form-label">System ID</label>
                            <input type="text" class="form-control" id="exportSystemId" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Export Format</label>
                                    <select class="form-select" id="exportFormat" required>
                                        <option value="zip">ZIP</option>
                                        <option value="tar">TAR</option>
                                        <option value="tar_gz">TAR.GZ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Security Level</label>
                                    <select class="form-select" id="exportSecurityLevel" required>
                                        <option value="standard">Standard</option>
                                        <option value="encrypted">Encrypted</option>
                                        <option value="signed">Digitally Signed</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <h6>Include Components</h6>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="exportIncludeModels" checked>
                                            <label class="form-check-label" for="exportIncludeModels">Models</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="exportIncludeAnalytics" checked>
                                            <label class="form-check-label" for="exportIncludeAnalytics">Analytics</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="exportIncludeLicenses" checked>
                                            <label class="form-check-label" for="exportIncludeLicenses">Licenses</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="exportSystem()">Export System</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Config Modal -->
    <div class="modal fade" id="createConfigModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Export Configuration</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="configForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Configuration Name</label>
                                    <input type="text" class="form-control" id="configName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">System ID</label>
                                    <input type="text" class="form-control" id="configSystemId" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="configDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Transfer Scope</label>
                            <select class="form-select" id="configScope" required>
                                <option value="full_system">Full System</option>
                                <option value="agents_only">Agents Only</option>
                                <option value="models_only">Models Only</option>
                                <option value="ui_only">UI Only</option>
                                <option value="api_only">API Only</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <h6>Include Components</h6>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="configIncludeModels" checked>
                                            <label class="form-check-label" for="configIncludeModels">Models</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="configIncludeAnalytics" checked>
                                            <label class="form-check-label" for="configIncludeAnalytics">Analytics</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="configIncludeLicenses" checked>
                                            <label class="form-check-label" for="configIncludeLicenses">Licenses</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createExportConfig()">Create Config</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentSystemId = null;

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadMetrics();
            loadTransferRequests();
            loadSystemExports();
            loadTransferHistory();
            loadExportConfigs();
            loadAuditLog();
        });

        // Load dashboard metrics
        async function loadMetrics() {
            try {
                const response = await fetch('/api/ownership-transfer/metrics');
                const metrics = await response.json();
                
                document.getElementById('total-transfers').textContent = metrics.total_transfers || 0;
                document.getElementById('active-transfers').textContent = metrics.active_transfers || 0;
                document.getElementById('completed-transfers').textContent = metrics.completed_transfers || 0;
                document.getElementById('total-exports').textContent = metrics.total_exports || 0;
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }

        // Load transfer requests
        async function loadTransferRequests() {
            try {
                const response = await fetch('/api/ownership-transfer/requests');
                const requests = await response.json();
                
                const container = document.getElementById('transfer-requests');
                container.innerHTML = '';
                
                requests.forEach(request => {
                    const card = createTransferCard(request);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading transfer requests:', error);
            }
        }

        // Create transfer card
        function createTransferCard(request) {
            const card = document.createElement('div');
            card.className = 'card transfer-card';
            
            const statusClass = `status-${request.status.toLowerCase().replace('_', '-')}`;
            const securityClass = `security-${request.security_level.toLowerCase().replace('_', '-')}`;
            
            card.innerHTML = `
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="card-title">
                                <span class="status-badge ${statusClass}">${request.status.replace('_', ' ').toUpperCase()}</span>
                                ${request.transfer_type.replace('_', ' ').toUpperCase()}
                            </h6>
                            <p class="card-text">
                                <strong>System:</strong> ${request.system_id}<br>
                                <strong>Scope:</strong> ${request.transfer_scope.replace('_', ' ').toUpperCase()}<br>
                                <strong>Format:</strong> ${request.export_format.toUpperCase()}<br>
                                <span class="security-badge ${securityClass}">${request.security_level.replace('_', ' ').toUpperCase()}</span>
                            </p>
                            <small class="text-muted">Created: ${new Date(request.created_at).toLocaleDateString()}</small>
                        </div>
                        <div class="col-md-4">
                            <div class="text-end">
                                <button class="btn btn-sm btn-outline-primary" onclick="executeTransfer('${request.transfer_id}')">
                                    <i class="fas fa-play me-1"></i>Execute
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="revokeTransfer('${request.transfer_id}')">
                                    <i class="fas fa-times me-1"></i>Revoke
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Load system exports
        async function loadSystemExports() {
            try {
                const response = await fetch('/api/ownership-transfer/exports');
                const exports = await response.json();
                
                const container = document.getElementById('system-exports');
                container.innerHTML = '';
                
                exports.forEach(export_item => {
                    const card = createExportCard(export_item);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading system exports:', error);
            }
        }

        // Create export card
        function createExportCard(export_item) {
            const card = document.createElement('div');
            card.className = 'card mb-3';
            
            card.innerHTML = `
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="card-title">System Export: ${export_item.system_id}</h6>
                            <p class="card-text">
                                <strong>Bundle ID:</strong> ${export_item.bundle_id}<br>
                                <strong>Size:</strong> ${(export_item.size_bytes / 1024 / 1024).toFixed(2)} MB<br>
                                <strong>Checksum:</strong> ${export_item.checksum.substring(0, 16)}...<br>
                                <strong>Created:</strong> ${new Date(export_item.created_at).toLocaleDateString()}
                            </p>
                        </div>
                        <div class="col-md-4">
                            <div class="text-end">
                                <button class="btn btn-sm btn-outline-primary" onclick="downloadBundle('${export_item.bundle_id}')">
                                    <i class="fas fa-download me-1"></i>Download
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="viewBundleDetails('${export_item.bundle_id}')">
                                    <i class="fas fa-eye me-1"></i>Details
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Load transfer history
        async function loadTransferHistory() {
            try {
                const response = await fetch('/api/ownership-transfer/history');
                const history = await response.json();
                
                const container = document.getElementById('transfer-history');
                container.innerHTML = '';
                
                history.forEach(item => {
                    const row = createHistoryRow(item);
                    container.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading transfer history:', error);
            }
        }

        // Create history row
        function createHistoryRow(item) {
            const row = document.createElement('div');
            row.className = 'card mb-2';
            
            row.innerHTML = `
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <strong>${item.action.replace('_', ' ').toUpperCase()}</strong>
                        </div>
                        <div class="col-md-3">
                            ${item.user_id}
                        </div>
                        <div class="col-md-3">
                            ${new Date(item.timestamp).toLocaleString()}
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-outline-info" onclick="viewHistoryDetails('${item.history_id}')">
                                <i class="fas fa-eye me-1"></i>Details
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return row;
        }

        // Load export configs
        async function loadExportConfigs() {
            try {
                const response = await fetch('/api/ownership-transfer/configs');
                const configs = await response.json();
                
                const container = document.getElementById('export-configs');
                container.innerHTML = '';
                
                configs.forEach(config => {
                    const card = createConfigCard(config);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading export configs:', error);
            }
        }

        // Create config card
        function createConfigCard(config) {
            const card = document.createElement('div');
            card.className = 'card mb-3';
            
            card.innerHTML = `
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="card-title">${config.name}</h6>
                            <p class="card-text">${config.description}</p>
                            <p class="card-text">
                                <strong>System:</strong> ${config.system_id}<br>
                                <strong>Scope:</strong> ${config.transfer_scope.replace('_', ' ').toUpperCase()}<br>
                                <strong>Created:</strong> ${new Date(config.created_at).toLocaleDateString()}
                            </p>
                        </div>
                        <div class="col-md-4">
                            <div class="text-end">
                                <button class="btn btn-sm btn-outline-primary" onclick="useConfig('${config.config_id}')">
                                    <i class="fas fa-play me-1"></i>Use Config
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="editConfig('${config.config_id}')">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Load audit log
        async function loadAuditLog() {
            try {
                const response = await fetch('/api/ownership-transfer/audit');
                const audit = await response.json();
                
                const container = document.getElementById('audit-log');
                container.innerHTML = '';
                
                audit.forEach(item => {
                    const row = createAuditRow(item);
                    container.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading audit log:', error);
            }
        }

        // Create audit row
        function createAuditRow(item) {
            const row = document.createElement('div');
            row.className = 'card mb-2';
            
            row.innerHTML = `
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <strong>${item.action}</strong>
                        </div>
                        <div class="col-md-4">
                            ${item.user_id}
                        </div>
                        <div class="col-md-4">
                            ${new Date(item.timestamp).toLocaleString()}
                        </div>
                    </div>
                </div>
            `;
            
            return row;
        }

        // Create transfer request
        async function createTransferRequest() {
            try {
                const data = {
                    system_id: document.getElementById('transferSystemId').value,
                    transfer_type: document.getElementById('transferType').value,
                    transfer_scope: document.getElementById('transferScope').value,
                    export_format: document.getElementById('exportFormat').value,
                    security_level: document.getElementById('securityLevel').value,
                    to_org_id: document.getElementById('toOrgId').value || null,
                    include_models: document.getElementById('includeModels').checked,
                    include_training_data: document.getElementById('includeTrainingData').checked,
                    include_analytics: document.getElementById('includeAnalytics').checked,
                    include_licenses: document.getElementById('includeLicenses').checked,
                    transfer_notes: document.getElementById('transferNotes').value
                };
                
                const response = await fetch('/api/ownership-transfer/requests', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    document.getElementById('createTransferModal').querySelector('.btn-close').click();
                    loadTransferRequests();
                }
            } catch (error) {
                console.error('Error creating transfer request:', error);
            }
        }

        // Execute transfer
        async function executeTransfer(transferId) {
            try {
                const response = await fetch(`/api/ownership-transfer/execute/${transferId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    loadTransferRequests();
                }
            } catch (error) {
                console.error('Error executing transfer:', error);
            }
        }

        // Revoke transfer
        async function revokeTransfer(transferId) {
            if (confirm('Are you sure you want to revoke this transfer?')) {
                try {
                    const response = await fetch(`/api/ownership-transfer/revoke/${transferId}`, {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        loadTransferRequests();
                    }
                } catch (error) {
                    console.error('Error revoking transfer:', error);
                }
            }
        }

        // Export system
        async function exportSystem() {
            try {
                const data = {
                    system_id: document.getElementById('exportSystemId').value,
                    export_format: document.getElementById('exportFormat').value,
                    security_level: document.getElementById('exportSecurityLevel').value,
                    include_models: document.getElementById('exportIncludeModels').checked,
                    include_analytics: document.getElementById('exportIncludeAnalytics').checked,
                    include_licenses: document.getElementById('exportIncludeLicenses').checked
                };
                
                const response = await fetch('/api/ownership-transfer/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    document.getElementById('exportSystemModal').querySelector('.btn-close').click();
                    loadSystemExports();
                }
            } catch (error) {
                console.error('Error exporting system:', error);
            }
        }

        // Create export config
        async function createExportConfig() {
            try {
                const data = {
                    name: document.getElementById('configName').value,
                    system_id: document.getElementById('configSystemId').value,
                    description: document.getElementById('configDescription').value,
                    transfer_scope: document.getElementById('configScope').value,
                    include_models: document.getElementById('configIncludeModels').checked,
                    include_analytics: document.getElementById('configIncludeAnalytics').checked,
                    include_licenses: document.getElementById('configIncludeLicenses').checked
                };
                
                const response = await fetch('/api/ownership-transfer/configs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    document.getElementById('createConfigModal').querySelector('.btn-close').click();
                    loadExportConfigs();
                }
            } catch (error) {
                console.error('Error creating export config:', error);
            }
        }

        // Placeholder functions for additional features
        function downloadBundle(bundleId) {
            alert('Download functionality would be implemented here for bundle: ' + bundleId);
        }

        function viewBundleDetails(bundleId) {
            alert('Bundle details would be shown here for: ' + bundleId);
        }

        function viewHistoryDetails(historyId) {
            alert('History details would be shown here for: ' + historyId);
        }

        function useConfig(configId) {
            alert('Use config functionality would be implemented here for: ' + configId);
        }

        function editConfig(configId) {
            alert('Edit config functionality would be implemented here for: ' + configId);
        }
    </script>
</body>
</html>
