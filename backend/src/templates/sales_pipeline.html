<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíº Sales Pipeline - System Build Hub OS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .stage-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .stage-intake { background: #e3f2fd; color: #1976d2; }
        .stage-analysis { background: #fff3e0; color: #f57c00; }
        .stage-poc_generation { background: #e8f5e8; color: #388e3c; }
        .stage-pre_call { background: #fce4ec; color: #c2185b; }
        .stage-live_call { background: #f3e5f5; color: #7b1fa2; }
        .stage-post_call { background: #e0f2f1; color: #00695c; }
        .stage-proposal { background: #fff8e1; color: #f57f17; }
        .stage-closed { background: #fafafa; color: #616161; }

        .opportunity-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .opportunity-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .opportunity-item:hover {
            border-color: #667eea;
        }

        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .opportunity-title {
            font-weight: 600;
            color: #495057;
            font-size: 1.1rem;
        }

        .opportunity-value {
            font-weight: 600;
            color: #28a745;
            font-size: 1.2rem;
        }

        .opportunity-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .opportunity-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .probability-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            transition: width 0.3s ease;
        }

        .live-call-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .feature-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .feature-input input {
            flex: 1;
        }

        .features-list {
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
        }

        .feature-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .opportunity-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíº Sales Pipeline</h1>
            <p>Automated sales pipeline with PoC generation, live call refinement, and demo creation</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('intake')">üìù Client Intake</div>
            <div class="tab" onclick="switchTab('opportunities')">üéØ Opportunities</div>
            <div class="tab" onclick="switchTab('live-call')">üìû Live Call</div>
            <div class="tab" onclick="switchTab('analytics')">üìä Analytics</div>
        </div>

        <!-- Client Intake Tab -->
        <div id="intake" class="tab-content active">
            <div class="main-content">
                <div class="card">
                    <h2>üìù New Client Intake</h2>
                    <form id="intakeForm">
                        <div class="form-group">
                            <label for="companyName">Company Name:</label>
                            <input type="text" id="companyName" name="companyName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="clientType">Client Type:</label>
                            <select id="clientType" name="clientType" required>
                                <option value="startup">Startup</option>
                                <option value="sme">SME</option>
                                <option value="enterprise">Enterprise</option>
                                <option value="agency">Agency</option>
                                <option value="individual">Individual</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="contactName">Contact Name:</label>
                            <input type="text" id="contactName" name="contactName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="contactEmail">Contact Email:</label>
                            <input type="email" id="contactEmail" name="contactEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="contactPhone">Contact Phone:</label>
                            <input type="tel" id="contactPhone" name="contactPhone">
                        </div>
                        
                        <div class="form-group">
                            <label for="projectDescription">Project Description:</label>
                            <textarea id="projectDescription" name="projectDescription" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectScope">Project Scope:</label>
                            <select id="projectScope" name="projectScope" required>
                                <option value="mvp">MVP</option>
                                <option value="full_featured">Full Featured</option>
                                <option value="enterprise">Enterprise</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="budgetRange">Budget Range:</label>
                            <select id="budgetRange" name="budgetRange" required>
                                <option value="$5K-$15K">$5K-$15K</option>
                                <option value="$15K-$30K">$15K-$30K</option>
                                <option value="$30K-$50K">$30K-$50K</option>
                                <option value="$50K-$100K">$50K-$100K</option>
                                <option value="$100K-$250K">$100K-$250K</option>
                                <option value="$250K+">$250K+</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="timeline">Timeline:</label>
                            <select id="timeline" name="timeline" required>
                                <option value="2-4 weeks">2-4 weeks</option>
                                <option value="1-2 months">1-2 months</option>
                                <option value="2-3 months">2-3 months</option>
                                <option value="3-6 months">3-6 months</option>
                                <option value="6-12 months">6-12 months</option>
                                <option value="12+ months">12+ months</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="keyFeatures">Key Features (comma-separated):</label>
                            <textarea id="keyFeatures" name="keyFeatures" placeholder="User authentication, API integration, etc."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="technicalRequirements">Technical Requirements (comma-separated):</label>
                            <textarea id="technicalRequirements" name="technicalRequirements" placeholder="React frontend, Python backend, etc."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="targetUsers">Target Users:</label>
                            <input type="text" id="targetUsers" name="targetUsers" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="competitors">Competitors (comma-separated):</label>
                            <textarea id="competitors" name="competitors"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="successMetrics">Success Metrics (comma-separated):</label>
                            <textarea id="successMetrics" name="successMetrics" placeholder="User engagement, conversion rate, etc."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="additionalNotes">Additional Notes:</label>
                            <textarea id="additionalNotes" name="additionalNotes"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-success">Create Opportunity</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Opportunities Tab -->
        <div id="opportunities" class="tab-content">
            <div class="card">
                <h2>üéØ Sales Opportunities</h2>
                <div id="opportunitiesList" class="opportunity-list">
                    <p>Loading opportunities...</p>
                </div>
            </div>
        </div>

        <!-- Live Call Tab -->
        <div id="live-call" class="tab-content">
            <div class="main-content">
                <div class="card">
                    <h2>üìû Live Call Session</h2>
                    <form id="liveCallForm">
                        <div class="form-group">
                            <label for="callOpportunityId">Opportunity ID:</label>
                            <input type="text" id="callOpportunityId" name="callOpportunityId" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="participants">Participants (comma-separated):</label>
                            <input type="text" id="participants" name="participants" placeholder="John Doe, Jane Smith" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="agenda">Agenda Items (comma-separated):</label>
                            <textarea id="agenda" name="agenda" placeholder="Project overview, feature discussion, timeline review" required></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-info">Start Live Call</button>
                    </form>
                    
                    <div id="liveCallSession" style="display: none;">
                        <div class="live-call-section">
                            <h3>üîÑ Live Call in Progress</h3>
                            <div id="liveCallStatus"></div>
                            
                            <div class="feature-input">
                                <input type="text" id="newFeature" placeholder="Add new feature during call...">
                                <button class="btn btn-success" onclick="addLiveFeature()">Add Feature</button>
                            </div>
                            
                            <div id="liveFeatures" class="features-list">
                                <p>No features added yet</p>
                            </div>
                            
                            <button class="btn btn-warning" onclick="endLiveCall()">End Call</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>üìä Call Summary</h2>
                    <div id="callSummary">
                        <p>No active call session</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <h2>üìä Sales Analytics</h2>
                <div id="analyticsContent">
                    <p>Loading analytics...</p>
                </div>
            </div>
        </div>

        <!-- Alerts -->
        <div id="alerts"></div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>
    </div>

    <script>
        // Global variables
        let opportunities = [];
        let currentSession = null;
        let liveFeatures = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadOpportunities();
            loadAnalytics();
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'opportunities') {
                loadOpportunities();
            } else if (tabName === 'analytics') {
                loadAnalytics();
            }
        }

        // Client Intake Form
        document.getElementById('intakeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                company_name: formData.get('companyName'),
                client_type: formData.get('clientType'),
                contact_name: formData.get('contactName'),
                contact_email: formData.get('contactEmail'),
                contact_phone: formData.get('contactPhone'),
                project_description: formData.get('projectDescription'),
                project_scope: formData.get('projectScope'),
                budget_range: formData.get('budgetRange'),
                timeline: formData.get('timeline'),
                key_features: formData.get('keyFeatures').split(',').map(f => f.trim()).filter(f => f),
                technical_requirements: formData.get('technicalRequirements').split(',').map(f => f.trim()).filter(f => f),
                target_users: formData.get('targetUsers'),
                competitors: formData.get('competitors').split(',').map(f => f.trim()).filter(f => f),
                success_metrics: formData.get('successMetrics').split(',').map(f => f.trim()).filter(f => f),
                additional_notes: formData.get('additionalNotes')
            };

            showLoading(true);
            
            try {
                const response = await fetch('/api/sales/intake', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('Opportunity created successfully!', 'success');
                    e.target.reset();
                    loadOpportunities();
                } else {
                    showAlert(`Failed to create opportunity: ${result.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        });

        // Live Call Form
        document.getElementById('liveCallForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const opportunityId = document.getElementById('callOpportunityId').value;
            const participants = document.getElementById('participants').value.split(',').map(p => p.trim()).filter(p => p);
            const agenda = document.getElementById('agenda').value.split(',').map(a => a.trim()).filter(a => a);

            showLoading(true);
            
            try {
                const response = await fetch('/api/sales/start-call', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        opportunity_id: opportunityId,
                        participants: participants,
                        agenda: agenda
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    currentSession = result.session_id;
                    showAlert('Live call session started!', 'success');
                    document.getElementById('liveCallSession').style.display = 'block';
                    document.getElementById('liveCallStatus').innerHTML = `
                        <p><strong>Session ID:</strong> ${result.session_id}</p>
                        <p><strong>Participants:</strong> ${participants.join(', ')}</p>
                        <p><strong>Agenda:</strong> ${agenda.join(', ')}</p>
                    `;
                } else {
                    showAlert(`Failed to start call: ${result.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        });

        // Add live feature
        async function addLiveFeature() {
            if (!currentSession) {
                showAlert('No active call session', 'error');
                return;
            }
            
            const featureDescription = document.getElementById('newFeature').value;
            if (!featureDescription) {
                showAlert('Please enter a feature description', 'error');
                return;
            }

            showLoading(true);
            
            try {
                const response = await fetch('/api/sales/add-feature', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: currentSession,
                        feature_description: featureDescription
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    liveFeatures.push(featureDescription);
                    updateLiveFeatures();
                    document.getElementById('newFeature').value = '';
                    showAlert('Feature added successfully!', 'success');
                } else {
                    showAlert(`Failed to add feature: ${result.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // End live call
        async function endLiveCall() {
            if (!currentSession) {
                showAlert('No active call session', 'error');
                return;
            }
            
            const feedback = prompt('Enter call feedback (comma-separated):');
            const decisions = prompt('Enter decisions made (comma-separated):');
            const nextActions = prompt('Enter next actions (comma-separated):');

            showLoading(true);
            
            try {
                const response = await fetch('/api/sales/end-call', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: currentSession,
                        feedback: feedback ? feedback.split(',').map(f => f.trim()).filter(f => f) : [],
                        decisions: decisions ? decisions.split(',').map(d => d.trim()).filter(d => d) : [],
                        next_actions: nextActions ? nextActions.split(',').map(a => a.trim()).filter(a => a) : []
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('Call session ended successfully!', 'success');
                    document.getElementById('liveCallSession').style.display = 'none';
                    document.getElementById('callSummary').innerHTML = `
                        <h3>Call Summary</h3>
                        <p><strong>Duration:</strong> ${result.duration_minutes.toFixed(1)} minutes</p>
                        <p><strong>Features Added:</strong> ${result.features_added}</p>
                        <p><strong>New Probability:</strong> ${(result.new_probability * 100).toFixed(1)}%</p>
                    `;
                    currentSession = null;
                    liveFeatures = [];
                    loadOpportunities();
                } else {
                    showAlert(`Failed to end call: ${result.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Update live features display
        function updateLiveFeatures() {
            const container = document.getElementById('liveFeatures');
            if (liveFeatures.length === 0) {
                container.innerHTML = '<p>No features added yet</p>';
                return;
            }
            
            container.innerHTML = liveFeatures.map(feature => `
                <div class="feature-item">${feature}</div>
            `).join('');
        }

        // Load opportunities
        async function loadOpportunities() {
            try {
                const response = await fetch('/api/sales/opportunities');
                const data = await response.json();
                
                if (response.ok) {
                    opportunities = data.opportunities || [];
                    displayOpportunities();
                } else {
                    showAlert(`Failed to load opportunities: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            }
        }

        // Display opportunities
        function displayOpportunities() {
            const container = document.getElementById('opportunitiesList');
            
            if (opportunities.length === 0) {
                container.innerHTML = '<p>No opportunities found</p>';
                return;
            }

            container.innerHTML = opportunities.map(opp => `
                <div class="opportunity-item">
                    <div class="opportunity-header">
                        <div class="opportunity-title">${opp.client_intake.company_name}</div>
                        <div class="opportunity-value">$${(opp.estimated_value / 1000).toFixed(0)}K</div>
                    </div>
                    
                    <div class="opportunity-details">
                        <div>
                            <p><strong>Contact:</strong> ${opp.client_intake.contact_name}</p>
                            <p><strong>Type:</strong> ${opp.client_intake.client_type}</p>
                            <p><strong>Scope:</strong> ${opp.client_intake.project_scope}</p>
                            <p><strong>Timeline:</strong> ${opp.client_intake.timeline}</p>
                        </div>
                        <div>
                            <p><strong>Stage:</strong> <span class="stage-indicator stage-${opp.stage}">${opp.stage}</span></p>
                            <p><strong>Probability:</strong> ${(opp.probability * 100).toFixed(1)}%</p>
                            <p><strong>Created:</strong> ${new Date(opp.created_at).toLocaleDateString()}</p>
                            <p><strong>Updated:</strong> ${new Date(opp.updated_at).toLocaleDateString()}</p>
                        </div>
                    </div>
                    
                    <div class="probability-bar">
                        <div class="probability-fill" style="width: ${opp.probability * 100}%"></div>
                    </div>
                    
                    <div class="opportunity-actions">
                        <button class="btn btn-info" onclick="analyzeRequirements('${opp.opportunity_id}')">Analyze</button>
                        <button class="btn btn-success" onclick="generatePoc('${opp.opportunity_id}')">Generate PoC</button>
                        <button class="btn btn-warning" onclick="generateDemo('${opp.opportunity_id}')">Generate Demo</button>
                        <button class="btn btn-info" onclick="generateProposal('${opp.opportunity_id}')">Generate Proposal</button>
                    </div>
                </div>
            `).join('');
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/api/sales/analytics');
                const data = await response.json();
                
                if (response.ok) {
                    displayAnalytics(data);
                } else {
                    showAlert(`Failed to load analytics: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            }
        }

        // Display analytics
        function displayAnalytics(data) {
            const container = document.getElementById('analyticsContent');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                        <h3>${data.total_opportunities}</h3>
                        <p>Total Opportunities</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                        <h3>$${(data.total_pipeline_value / 1000).toFixed(0)}K</h3>
                        <p>Pipeline Value</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                        <h3>${(data.conversion_rate * 100).toFixed(1)}%</h3>
                        <p>Conversion Rate</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                        <h3>$${(data.average_opportunity_value / 1000).toFixed(0)}K</h3>
                        <p>Average Value</p>
                    </div>
                </div>
            `;
        }

        // Opportunity actions
        async function analyzeRequirements(opportunityId) {
            showLoading(true);
            
            try {
                const response = await fetch(`/api/sales/analyze/${opportunityId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showAlert('Requirements analysis completed!', 'success');
                    loadOpportunities();
                } else {
                    showAlert(`Analysis failed: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function generatePoc(opportunityId) {
            showLoading(true);
            
            try {
                const response = await fetch(`/api/sales/generate-poc/${opportunityId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showAlert('PoC generated successfully!', 'success');
                    loadOpportunities();
                } else {
                    showAlert(`PoC generation failed: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function generateDemo(opportunityId) {
            showLoading(true);
            
            try {
                const response = await fetch('/api/sales/generate-demo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        opportunity_id: opportunityId,
                        demo_config: {
                            demo_type: 'deck',
                            target_audience: 'decision_makers',
                            duration: 15,
                            key_points: ['Problem', 'Solution', 'Features', 'ROI'],
                            custom_branding: true,
                            include_pricing: false,
                            interactive_elements: true
                        }
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert('Demo generated successfully!', 'success');
                    loadOpportunities();
                } else {
                    showAlert(`Demo generation failed: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function generateProposal(opportunityId) {
            showLoading(true);
            
            try {
                const response = await fetch(`/api/sales/generate-proposal/${opportunityId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showAlert('Proposal generated successfully!', 'success');
                    loadOpportunities();
                } else {
                    showAlert(`Proposal generation failed: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Utility functions
        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            alertsContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>
